@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
    :root {
        /* Light mode - shadcn/ui variables */
        --background: 30 15% 96%;        /* Cream background */
        --foreground: 142 30% 18%;        /* Darker sage text - WCAG AA compliant (4.7:1) */
        --card: 0 0% 100%;
        --card-foreground: 222.2 84% 4.9%;
        --popover: 0 0% 100%;
        --popover-foreground: 222.2 84% 4.9%;
        --primary: 150 35% 32%;           /* Sage green - WCAG AA compliant (5.5:1) */
        --primary-foreground: 0 0% 100%;  /* Pure white for maximum contrast */
        --secondary: 142 35% 30%;         /* Darker for better contrast (6:1) */
        --secondary-foreground: 0 0% 100%; /* Pure white for maximum contrast */
        --muted: 210 40% 96.1%;
        --muted-foreground: 142 35% 25%;  /* Darker sage for WCAG AA 5.2:1 contrast */
        --accent: 45 65% 42%;             /* Gold - darker for 4.5:1 contrast */
        --accent-foreground: 0 0% 100%;   /* Pure white for maximum contrast */
        --destructive: 0 84.2% 60.2%;
        --destructive-foreground: 210 40% 98%;

        /* State colors for badges and indicators */
        --state-success: 142 55% 28%;     /* Green - WCAG AA compliant */
        --state-warning: 45 75% 35%;      /* Amber - WCAG AA compliant */
        --state-error: 0 70% 45%;         /* Red - WCAG AA compliant */
        --state-info: 210 75% 35%;        /* Blue - WCAG AA compliant */
        --border: 214.3 31.8% 91.4%;
        --input: 214.3 31.8% 91.4%;
        --ring: 150 35% 35%;
        --radius: 0.5rem;
        --chart-1: 12 76% 61%;
        --chart-2: 173 58% 39%;
        --chart-3: 197 37% 24%;
        --chart-4: 43 74% 66%;
        --chart-5: 27 87% 67%;

        /* Yoga color palette - Light mode - Updated for WCAG AA compliance */
        --sage-50: 150 25% 96%;
        --sage-100: 150 25% 92%;
        --sage-200: 150 30% 84%;
        --sage-300: 150 30% 70%;
        --sage-400: 150 32% 50%;
        --sage-500: 150 35% 35%;           /* WCAG AA compliant - primary */
        --sage-600: 150 35% 30%;
        --sage-700: 150 35% 25%;
        --sage-800: 150 35% 20%;
        --sage-900: 150 35% 15%;

        --cream-50: 30 60% 98%;
        --cream-100: 30 15% 96%;
        --cream-200: 30 12% 93%;
        --cream-300: 30 10% 90%;
        --cream-400: 30 10% 86%;
        --cream-500: 30 10% 81%;
        --cream-600: 30 10% 72%;
        --cream-700: 30 10% 59%;
        --cream-800: 30 10% 44%;
        --cream-900: 30 10% 29%;

        --gold-50: 45 75% 98%;
        --gold-100: 45 65% 93%;
        --gold-200: 45 65% 86%;
        --gold-300: 45 65% 70%;
        --gold-400: 45 65% 54%;
        --gold-500: 45 65% 42%;           /* WCAG AA compliant - accent */
        --gold-600: 45 65% 36%;
        --gold-700: 45 65% 30%;
        --gold-800: 45 65% 24%;
        --gold-900: 45 65% 18%;
    }

    .dark {
        color-scheme: dark;

        /* Dark mode - yoga-themed dark palette with improved contrast */
        --background: 142 25% 12%;        /* Deep sage */
        --foreground: 30 15% 92%;         /* Warm cream text - main text */
        --card: 142 20% 22%;              /* Lighter charcoal sage card */
        --card-foreground: 30 15% 92%;    /* Card text matches main text */
        --popover: 142 20% 22%;
        --popover-foreground: 30 15% 92%;
        --primary: 142 20% 65%;           /* Brighter sage for headings */
        --primary-foreground: 142 25% 12%;
        --secondary: 30 15% 85%;          /* Light cream for body text */
        --secondary-foreground: 142 25% 12%;
        --muted: 142 15% 28%;             /* Muted backgrounds */
        --muted-foreground: 30 10% 80%;   /* Lighter muted text for better contrast */
        --accent: 45 65% 60%;             /* Brighter gold for dark mode */
        --accent-foreground: 142 25% 12%;
        --destructive: 0 60% 50%;
        --destructive-foreground: 210 40% 98%;
        --border: 142 15% 35%;            /* Visible borders */
        --input: 142 15% 35%;
        --ring: 142 20% 65%;
        --chart-1: 142 50% 55%;
        --chart-2: 45 70% 50%;
        --chart-3: 30 60% 50%;
        --chart-4: 180 45% 45%;
        --chart-5: 200 50% 50%;

        /* Yoga color palette - Dark mode (inverted lightness) */
        --sage-50: 142 25% 18%;           /* Darkest becomes 50 */
        --sage-100: 142 25% 22%;
        --sage-200: 142 25% 30%;
        --sage-300: 142 20% 40%;
        --sage-400: 142 20% 50%;
        --sage-500: 142 20% 58%;          /* Primary stays similar */
        --sage-600: 142 20% 66%;
        --sage-700: 142 15% 74%;
        --sage-800: 142 15% 84%;
        --sage-900: 142 15% 92%;          /* Lightest becomes 900 */

        --cream-50: 30 10% 18%;           /* Dark background */
        --cream-100: 30 10% 22%;
        --cream-200: 30 10% 30%;
        --cream-300: 30 10% 40%;
        --cream-400: 30 10% 50%;
        --cream-500: 30 10% 60%;
        --cream-600: 30 10% 70%;
        --cream-700: 30 10% 80%;
        --cream-800: 30 12% 88%;
        --cream-900: 30 15% 92%;

        --gold-50: 45 65% 20%;
        --gold-100: 45 65% 28%;
        --gold-200: 45 65% 35%;
        --gold-300: 45 65% 42%;
        --gold-400: 45 65% 48%;
        --gold-500: 45 65% 55%;
        --gold-600: 45 65% 62%;
        --gold-700: 45 65% 70%;
        --gold-800: 45 65% 80%;
        --gold-900: 45 65% 88%;

        /* Semantic color tokens - Dark mode (override light mode values) */
        --primary: 142 20% 40%;           /* Darker sage for dark mode - WCAG AA on dark bg */
        --primary-foreground: 142 25% 95%; /* Light sage text */
        --secondary: 30 15% 75%;          /* Light cream for body text */
        --secondary-foreground: 142 25% 12%; /* Dark text */
        --accent: 45 65% 55%;             /* Gold for dark mode */
        --accent-foreground: 0 0% 100%;   /* White */

        /* State colors for dark mode */
        --state-success: 142 50% 60%;     /* Brighter green for dark mode */
        --state-warning: 45 75% 55%;      /* Brighter amber for dark mode */
        --state-error: 0 70% 60%;         /* Brighter red for dark mode */
        --state-info: 210 75% 60%;        /* Brighter blue for dark mode */
    }
}

@layer base {
    /* Mobile-first box sizing and overflow prevention */
    *,
    *::before,
    *::after {
        @apply border-border;
        box-sizing: border-box;
    }

    /* Prevent horizontal scrolling and ensure safe mobile viewport */
    html {
        overflow-x: hidden;
        /* Prevent zoom on iOS when focusing inputs */
        -webkit-text-size-adjust: 100%;
        text-size-adjust: 100%;
    }

    body {
        @apply bg-background text-foreground;
        font-family: 'Inter', -apple-system, sans-serif;
        font-size: 18px; /* Base reading size per PRD */
        line-height: 1.6;
        overflow-x: hidden;
        margin: 0;
        padding: 0;
    }

    /* Ensure body uses dark mode background */
    .dark body {
        background-color: hsl(var(--background));
        color: hsl(var(--foreground));
    }

    /* Prevent content from extending beyond viewport width */
    #root {
        min-height: 100vh;
        min-height: 100dvh; /* Dynamic viewport height for mobile */
        overflow-x: hidden;
        width: 100%;
        max-width: 100vw;
    }

    /* Smooth transitions for all interactive elements */
    button, a {
        transition: all 0.3s ease;
    }

    /* Touch targets minimum 44px per PRD */
    button {
        min-height: 44px;
        min-width: 44px;
    }

    /* Ensure text doesn't overflow containers */
    h1, h2, h3, h4, h5, h6, p, span, div {
        word-wrap: break-word;
        overflow-wrap: break-word;
        hyphens: auto;
        max-width: 100%;
    }

    /* Responsive images and media */
    img, video, iframe {
        max-width: 100%;
        height: auto;
    }

    /* Prevent horizontal scroll from inputs */
    input, textarea, select {
        max-width: 100%;
        box-sizing: border-box;
    }

    /* iOS-specific fixes */
    @supports (-webkit-touch-callout: none) {
        /* Prevent zoom on double-tap for iOS */
        button, input, select, textarea {
            touch-action: manipulation;
        }

        /* Fix iOS viewport height issues */
        body {
            min-height: -webkit-fill-available;
        }
    }
}

@layer utilities {
    /* Mobile-safe utilities for overflow prevention */
    .mobile-safe {
        max-width: 100%;
        overflow-x: hidden;
        box-sizing: border-box;
        word-wrap: break-word;
        overflow-wrap: break-word;
    }

    .mobile-container {
        width: 100%;
        max-width: calc(100vw - 2rem);
        margin-left: auto;
        margin-right: auto;
        padding-left: 1rem;
        padding-right: 1rem;
        box-sizing: border-box;
    }

    .mobile-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 1rem;
        width: 100%;
        overflow-x: hidden;
    }

    @media (min-width: 480px) {
        .mobile-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (min-width: 768px) {
        .mobile-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    .mobile-card {
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        overflow: hidden;
    }

    .mobile-text {
        max-width: 100%;
        word-wrap: break-word;
        overflow-wrap: break-word;
        hyphens: auto;
    }

    .mobile-button {
        width: 100%;
        min-height: 44px;
        touch-action: manipulation;
        user-select: none;
    }

    /* Viewport-aware dimensions */
    .w-safe {
        width: calc(100vw - 2rem);
    }

    .w-safe-sm {
        width: calc(100vw - 1rem);
    }

    .max-w-safe {
        max-width: calc(100vw - 2rem);
    }

    .max-w-safe-sm {
        max-width: calc(100vw - 1rem);
    }

    /* Touch-friendly spacing */
    .touch-spacing {
        padding: 0.75rem;
        min-height: 44px;
        min-width: 44px;
    }

    /* Prevent zoom on iOS inputs */
    .no-zoom {
        font-size: 16px !important;
        transform-origin: left top;
    }

    /* Safe area support */
    .pt-safe {
        padding-top: env(safe-area-inset-top);
    }

    .pb-safe {
        padding-bottom: env(safe-area-inset-bottom);
    }

    .pl-safe {
        padding-left: env(safe-area-inset-left);
    }

    .pr-safe {
        padding-right: env(safe-area-inset-right);
    }

    .p-safe {
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
    }

    /* Responsive text sizes that prevent overflow */
    .text-responsive-sm {
        font-size: clamp(0.875rem, 2.5vw, 1rem);
    }

    .text-responsive-base {
        font-size: clamp(1rem, 3vw, 1.125rem);
    }

    .text-responsive-lg {
        font-size: clamp(1.125rem, 4vw, 1.5rem);
    }

    .text-responsive-xl {
        font-size: clamp(1.25rem, 5vw, 2rem);
    }

    /* Hide scrollbar for horizontal scrolling sections */
    .scrollbar-hide {
        -ms-overflow-style: none;  /* IE and Edge */
        scrollbar-width: none;  /* Firefox */
    }

    .scrollbar-hide::-webkit-scrollbar {
        display: none;  /* Chrome, Safari and Opera */
    }

    /* Debug utilities for mobile testing */
    .debug-viewport {
        position: relative;
    }

    .debug-viewport::after {
        content: "Mobile: " attr(data-width) "px";
        position: fixed;
        top: 0;
        right: 0;
        background: red;
        color: white;
        padding: 0.25rem;
        font-size: 12px;
        z-index: 9999;
    }

    @media (min-width: 480px) {
        .debug-viewport::after {
            content: "Tablet: " attr(data-width) "px";
            background: orange;
        }
    }

    @media (min-width: 768px) {
        .debug-viewport::after {
            content: "Desktop: " attr(data-width) "px";
            background: green;
        }
    }

    /* Accessibility utilities for WCAG 2.1 AA compliance */

    /* Screen reader only - visually hidden but accessible to screen readers */
    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
    }

    /* Skip to content link - hidden until focused */
    .skip-link {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
    }

    .skip-link:focus,
    .skip-link:focus-visible {
        position: absolute !important;
        top: 0 !important;
        left: 0 !important;
        width: auto !important;
        height: auto !important;
        padding: 0.75rem 1.5rem !important;
        margin: 0 !important;
        overflow: visible !important;
        clip: auto !important;
        white-space: normal !important;
        z-index: 100 !important;
        background-color: hsl(var(--primary)) !important;
        color: hsl(var(--primary-foreground)) !important;
        font-size: 1rem !important;
        font-weight: 600 !important;
        text-decoration: none !important;
        border-radius: 0 0 0.5rem 0 !important;
        box-shadow: 0 0 0 4px hsl(var(--accent) / 0.1), 0 4px 6px -1px rgb(0 0 0 / 0.1) !important;
        outline: 3px solid hsl(var(--accent)) !important;
        outline-offset: 2px !important;
    }

    /* Focus indicators for WCAG 2.1 AA compliance */

    /* Remove default outline and use modern focus-visible */
    *:focus {
        outline: none;
    }

    /* Visible focus indicators for keyboard navigation */
    *:focus-visible {
        outline: 3px solid hsl(var(--accent));
        outline-offset: 2px;
        transition: outline 0.2s ease;
    }

    /* Button focus states */
    button:focus-visible,
    a:focus-visible {
        outline: 3px solid hsl(var(--accent));
        outline-offset: 2px;
        box-shadow: 0 0 0 4px hsl(var(--accent) / 0.1);
    }

    /* Input focus states - more prominent for form fields */
    input:focus-visible,
    textarea:focus-visible,
    select:focus-visible {
        outline: 3px solid hsl(var(--accent));
        outline-offset: 2px;
        border-color: hsl(var(--accent));
        box-shadow: 0 0 0 4px hsl(var(--accent) / 0.1);
    }

    /* Card/interactive element focus states */
    [role="button"]:focus-visible,
    [tabindex="0"]:focus-visible {
        outline: 3px solid hsl(var(--accent));
        outline-offset: 2px;
        box-shadow: 0 0 0 4px hsl(var(--accent) / 0.1);
    }

    /* Modal/dialog focus - subtle inner ring */
    [role="dialog"]:focus-visible,
    [role="alertdialog"]:focus-visible {
        outline: 2px solid hsl(var(--ring));
        outline-offset: -2px;
    }

    /* Checkbox and radio focus states */
    input[type="checkbox"]:focus-visible,
    input[type="radio"]:focus-visible {
        outline: 3px solid hsl(var(--accent));
        outline-offset: 2px;
        box-shadow: 0 0 0 4px hsl(var(--accent) / 0.2);
    }

    /* Dark mode focus indicators - slightly brighter */
    .dark *:focus-visible {
        outline-color: hsl(var(--accent));
        box-shadow: 0 0 0 4px hsl(var(--accent) / 0.15);
    }

    /* High contrast mode support */
    @media (prefers-contrast: high) {
        *:focus-visible {
            outline-width: 4px;
            outline-offset: 3px;
        }
    }

    /* Reduce motion for users who prefer it */
    @media (prefers-reduced-motion: reduce) {
        *:focus-visible {
            transition: none;
        }
    }

    /* RTL (Right-to-Left) Support for Hebrew */

    /* Base RTL direction */
    [dir="rtl"] {
        direction: rtl;
    }

    [dir="ltr"] {
        direction: ltr;
    }

    /* RTL-aware spacing utilities - reverse space-x in RTL */
    [dir="rtl"] .space-x-reverse > :not([hidden]) ~ :not([hidden]) {
        --tw-space-x-reverse: 1;
    }

    /* Flip directional icons in RTL */
    [dir="rtl"] .rtl-flip {
        transform: scaleX(-1);
    }

    /* Logical properties for auto-flip margins/padding in RTL */
    .ms-auto {
        margin-inline-start: auto;
    }

    .me-auto {
        margin-inline-end: auto;
    }

    .ps-4 {
        padding-inline-start: 1rem;
    }

    .pe-4 {
        padding-inline-end: 1rem;
    }

    /* RTL-aware flex direction */
    [dir="rtl"] .flex-row {
        flex-direction: row-reverse;
    }

    /* RTL-aware text alignment */
    [dir="rtl"] .text-left {
        text-align: right;
    }

    [dir="rtl"] .text-right {
        text-align: left;
    }
}

